{% extends 'base.html' %}
{% block content %}

<main class="max-w-5xl mx-auto px-6 py-10">

Â  <section class="bg-white shadow-lg rounded-2xl p-8 mb-8">
Â  Â  <h1 class="text-3xl font-bold text-gray-800 mb-4">{{ title }}</h1>

Â  Â  Â  Â  {% if lesson.video_url or lesson.video %}
Â  Â  Â  Â  Â  Â  Â  Â  <div class="mb-4 relative" style="padding-bottom: 56.25%; height: 0; overflow: hidden;">

Â  Â  Â 
Â  Â  Â  Â  Â  Â  {% if lesson.video_url %}
Â  Â  Â  Â 
Â  Â  Â  Â  {% set video_url = lesson.video_url %}
Â  Â  Â  Â  
Â  Â  Â  Â  {# Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±Ø§Ø¨Ø· ÙŠÙˆØªÙŠÙˆØ¨: Ø§Ø³ØªØ®Ø±Ø§Ø¬ ID Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¨Ø´ÙƒÙ„ Ø¢Ù…Ù† #}
Â  Â  Â  Â  {% set video_id = '' %}
Â  Â  Â  Â  
Â  Â  Â  Â  {% if 'v=' in video_url %}
Â  Â  Â  Â  Â  {% set video_id_parts = video_url.split('v=') %}
Â  Â  Â  Â  Â  {% set video_id = video_id_parts[-1].split('&')[0].split('?')[0] %}
Â  Â  Â  Â  
Â  Â  Â  Â  {% elif 'youtu.be/' in video_url %}
Â  Â  Â  Â  Â  {% set video_id = video_url.split('/')[-1].split('?')[0] %}
Â  Â  Â  Â  
Â  Â  Â  Â  {% elif 'embed/' in video_url %}
Â  Â  Â  Â  Â  {% set video_id = video_url.split('embed/')[-1].split('?')[0] %}
Â  Â  Â  Â  {% endif %}
Â  Â  Â  Â 
Â  Â  Â  Â  {# Ø¨Ù†Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ¶Ù…ÙŠÙ† Ø§Ù„Ø£ÙƒØ«Ø± ØªÙ‚ÙŠÙŠØ¯Ø§Ù‹ #}
        {# ğŸ’¡ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ù„ØªÙ‚ÙŠÙŠØ¯ ÙŠÙˆØªÙŠÙˆØ¨: #}
        {# - modestbranding=1: ÙŠÙ‚Ù„Ù„ Ø¹Ù„Ø§Ù…Ø© ÙŠÙˆØªÙŠÙˆØ¨ ÙˆÙŠÙ…Ù†Ø¹ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„ÙŠÙ‡Ø§. #}
        {# - rel=0: ÙŠÙ…Ù†Ø¹ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø°Ø§Øª ØµÙ„Ø© ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©. #}
        {# - showinfo=0: ÙŠØ²ÙŠÙ„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù‚Ù†Ø§Ø©. #}
        {# - iv_load_policy=3: ÙŠÙ…Ù†Ø¹ Ø¸Ù‡ÙˆØ± Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø§Ù„ØªÙˆØ¶ÙŠØ­ÙŠØ©. #}
        {# - disablekb=1: ÙŠØ¹Ø·Ù„ Ø§Ø®ØªØµØ§Ø±Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­. #}
        {% set embed_url = "https://www.youtube-nocookie.com/embed/" ~ video_id ~ "?modestbranding=1&rel=0&showinfo=0&iv_load_policy=3&disablekb=1" %}


Â  Â  Â  Â  <iframe
Â  Â  Â  Â  Â  Â  id="youtube-iframe"
Â  Â  Â  Â  Â  Â  src="{{ embed_url }}"
Â  Â  Â  Â  Â  Â  frameborder="0"
Â  Â  Â  Â  Â  Â  allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture; fullscreen"
Â  Â  Â  Â  Â  Â  allowfullscreen
Â  Â  Â  Â  Â  Â  loading="lazy"
Â  Â  Â  Â  Â  Â  class="w-full h-full rounded-xl shadow-2xl absolute inset-0">
Â  Â  Â  Â  </iframe>

Â  Â  Â  Â  Â  Â  {% elif lesson.video %}
Â  Â  Â  Â  {# ÙÙŠØ¯ÙŠÙˆ Ù…Ø­Ù„ÙŠ: Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙˆØ³Ù… Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø£ØµÙ„ÙŠ #}
Â  Â  Â  Â  <video controls class="w-full h-full object-cover rounded-xl shadow-2xl absolute inset-0">
Â  Â  Â  Â  Â  <source src="{{ url_for('uploaded_file', filename=lesson.video) }}" type="video/mp4">
Â  Â  Â  Â  Â  {% if lang == 'ar' %} Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ. {% else %} Your browser does not support video playback. {% endif %}
Â  Â  Â  Â  </video>
Â  Â  Â  {% endif %}
Â  Â  </div>
Â  Â  
Â  Â  Â  Â  <button id="copy-lesson-link" 
Â  Â  Â  Â  Â  Â  class="mt-2 inline-flex items-center gap-2 bg-purple-600 text-white px-4 py-2 rounded font-medium hover:bg-purple-700 transition shadow">
Â  Â  Â  Â  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
Â  Â  Â  Â  {% if lang == 'ar' %} Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø±Ø³ (Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù†ØµØ©) {% else %} Copy Lesson Link (Platform URL) {% endif %}
Â  Â  </button>
Â  Â  
Â  Â  {% endif %}

Â  Â  <p class="text-gray-700 leading-relaxed mt-6 mb-6">
Â  Â  Â  {{ description }}
Â  Â  </p>

Â  Â  {# ğŸ’¡ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯: Ø¹Ø±Ø¶ Ø±Ø§Ø¨Ø· Ø®Ø§Ø±Ø¬ÙŠ Ø¨Ø¹Ù†ÙˆÙ† (Ø¥Ø°Ø§ ØªÙˆÙØ±Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª) ğŸ’¡ #}
Â  Â  {% if lesson.link_url and lesson.link_title %}
Â  Â  <div class="bg-indigo-50 p-4 rounded-lg border border-indigo-200 mb-6">
Â  Â  Â  <h3 class="font-semibold text-lg mb-2 text-indigo-700">
Â  Â  Â  Â  {% if lang == 'ar' %} ğŸ”— Ø±Ø§Ø¨Ø· Ø®Ø§Ø±Ø¬ÙŠ Ù…ÙÙŠØ¯ {% else %} ğŸ”— Useful External Link {% endif %}
Â  Â  Â  </h3>
Â  Â  Â  <a href="{{ lesson.link_url }}" 
Â  Â  Â  Â  Â  target="_blank" 
Â  Â  Â  Â  Â  rel="noopener noreferrer"
Â  Â  Â  Â  Â  class="inline-flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded font-medium hover:bg-indigo-700 transition shadow">
Â  Â  Â  Â  <span>{{ lesson.link_title }}</span>
Â  Â  Â  Â  <svg class="w-4 h-4 transform {{ 'rotate-180' if lang == 'ar' else '' }}" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
Â  Â  Â  </a>
Â  Â  </div>
Â  Â  {% endif %}

Â  Â  {% if lesson.material %}
Â  Â  <div class="bg-gray-50 p-4 rounded-lg border">
Â  Â  Â  <h3 class="font-semibold text-lg mb-2 text-blue-700">
Â  Â  Â  Â  {% if lang == 'ar' %} ğŸ“˜ Ù…ÙˆØ§Ø¯ Ø¥Ø¶Ø§ÙÙŠØ© {% else %} ğŸ“˜ Additional Materials {% endif %}
Â  Â  Â  </h3>
Â  Â  Â  <a href="{{ url_for('uploaded_file', filename=lesson.material) }}" 
Â  Â  Â  Â  Â  class="inline-block bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition shadow">
Â  Â  Â  Â  {% if lang == 'ar' %} ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù {% else %} Download File {% endif %}
Â  Â  Â  </a>
Â  Â  </div>
Â  Â  {% endif %}
Â  </section>

Â  <div class="text-center">
Â  Â  <a href="{{ url_for('course_page', course_id=lesson.course_id) }}" 
Â  Â  Â  Â  class="inline-block px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold rounded-xl shadow">
Â  Â  Â  {% if lang == 'ar' %} â¬…ï¸ Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¯ÙˆØ±Ø© {% else %} â¬…ï¸ Back to Course {% endif %}
Â  Â  </a>
Â  </div>

</main>

<script>
Â  Â  // ÙˆØ¸ÙŠÙØ© Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù†ØµØ© Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©
Â  Â  function copyToClipboard(text) {
Â  Â  Â  Â  // ÙŠØ³ØªØ®Ø¯Ù… document.execCommand('copy') ÙƒØ¨Ø¯ÙŠÙ„ Ù…Ø¶Ù…ÙˆÙ† Ù„Ù€ navigator.clipboard
Â  Â  Â  Â  const textarea = document.createElement('textarea');
Â  Â  Â  Â  textarea.value = text;
        textarea.style.position = 'fixed'; // Ù„Ø¬Ø¹Ù„Ù‡ ØºÙŠØ± Ù…Ø±Ø¦ÙŠ
        textarea.style.opacity = 0;
Â  Â  Â  Â  document.body.appendChild(textarea);
Â  Â  Â  Â  textarea.select();
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  document.execCommand('copy');
Â  Â  Â  Â  Â  Â  return true;
Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  Â  console.error('ÙØ´Ù„ ÙÙŠ Ù†Ø³Ø® Ø§Ù„Ù†Øµ: ', err);
Â  Â  Â  Â  Â  Â  return false;
Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  document.body.removeChild(textarea);
Â  Â  Â  Â  }
Â  Â  }

Â  Â  window.onload = function() {
Â  Â  Â  Â  const copyButton = document.getElementById('copy-lesson-link');
Â  Â  Â  Â  const iframe = document.getElementById('youtube-iframe');
Â  Â  Â  Â  
Â  Â  Â  Â  // 1. Ù…Ù†Ø·Ù‚ Ø²Ø± Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù†ØµØ©
Â  Â  Â  Â  if (copyButton) {
Â  Â  Â  Â  Â  Â  copyButton.addEventListener('click', function() {
Â  Â  Â  Â  Â  Â  Â  Â  const lessonUrl = window.location.href; // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ø­Ø§Ù„ÙŠ
Â  Â  Â  Â  Â  Â  Â  Â  const success = copyToClipboard(lessonUrl);
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  if (success) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const originalText = copyButton.innerHTML;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  copyButton.innerHTML = '{% if lang == 'ar' %} âœ… ØªÙ… Ø§Ù„Ù†Ø³Ø®! {% else %} âœ… Copied! {% endif %}';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  copyButton.classList.add('bg-green-500', 'hover:bg-green-600');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  copyButton.classList.remove('bg-purple-600', 'hover:bg-purple-700');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  copyButton.innerHTML = originalText;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  copyButton.classList.remove('bg-green-500', 'hover:-green-600');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  copyButton.classList.add('bg-purple-600', 'hover:bg-purple-700');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, 2000);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  // 2. Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ù†Ø¹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†Ù‚Ø± Ø¨Ø²Ø± Ø§Ù„Ù…Ø§ÙˆØ³ Ø§Ù„Ø£ÙŠÙ…Ù† (Context Menu) Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø·Ø§Ø±
Â  Â  Â  Â  // Ù…Ù„Ø§Ø­Ø¸Ø©: Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù…Ù†Ø¹ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø¨Ø´ÙƒÙ„ Ù…Ø·Ù„Ù‚ Ù…Ù† Ø¬Ø§Ù†Ø¨ Ø§Ù„Ù…ØªØµÙØ­.
Â  Â  Â  Â  if (iframe) {
Â  Â  Â  Â  Â  Â  iframe.addEventListener('contextmenu', function(e) {
Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  };
</script>

{% endblock %}
