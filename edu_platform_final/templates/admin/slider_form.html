{% extends 'base.html' %}
{% block content %}
<main class="bg-gradient-to-br from-white via-gray-50 to-indigo-50 min-h-screen py-16 font-sans">
    <div class="max-w-4xl mx-auto bg-white rounded-2xl shadow-2xl p-8 border border-gray-100">
        
        <h1 class="text-3xl font-extrabold text-indigo-700 mb-8 pb-4 border-b border-gray-200">
            {% if slide %}
                {{ 'Edit Slider Image & Text' if lang=='en' else 'ØªØ¹Ø¯ÙŠÙ„ Ø´Ø±ÙŠØ­Ø© Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ' }}
            {% else %}
                {{ 'Add New Slider Image & Text' if lang=='en' else 'Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙŠØ­Ø© Ø´Ø±ÙŠØ· Ø±Ø¦ÙŠØ³ÙŠ Ø¬Ø¯ÙŠØ¯Ø©' }}
            {% endif %}
        </h1>

        {# Ø¹Ø±Ø¶ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙÙ„Ø§Ø´ (Flash messages) #}
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="p-3 mb-4 rounded-lg text-sm {% if category == 'success' %}bg-green-100 text-green-800{% elif category == 'error' %}bg-red-100 text-red-800{% else %}bg-blue-100 text-blue-800{% endif %}" role="alert">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        {# ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ (Action) Ù„Ù„Ù†Ù…ÙˆØ°Ø¬ #}
        <form method="POST" 
            action="{% if slide %}{{ url_for('admin_slider_edit', slide_id=slide.id, lang=lang) }}{% else %}{{ url_for('admin_slider_new', lang=lang) }}{% endif %}" 
            enctype="multipart/form-data" 
            class="space-y-6">
            
            {# ğŸ¯ Ø§Ù„ØªØµØ­ÙŠØ­ 1: Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø£Ù‚ÙˆØ§Ø³ Ù‡Ù†Ø§ #}
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}"> 

            {# Ù‚Ø³Ù… Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙˆÙ…ÙŠØ²Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© #}
            {% if slide and slide.image_path %}
            <div class="bg-gray-50 p-6 rounded-xl border border-gray-200 shadow-inner">
                <label class="block text-lg font-semibold text-gray-700 mb-3">{{ 'Current Image' if lang=='en' else 'Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©' }}</label>
                <div class="flex flex-col md:flex-row items-start md:items-center gap-4">
                    <div class="w-full md:w-1/2 h-48 rounded-lg overflow-hidden shadow-lg border-2 border-indigo-300 flex-shrink-0">
                        <img src="{{ url_for('uploaded_file', filename=slide.image_path) or url_for('static', filename='placeholder.jpg') }}" 
                            alt="{{ slide.title_en }}" class="w-full h-full object-cover">
                    </div>

                    <div class="w-full md:w-1/2 space-y-3">
                        <p class="text-sm text-gray-600 font-medium">{{ 'Manage Image:' if lang=='en' else 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙˆØ±Ø©:' }}</p>

                        <a href="{{ url_for('admin_slider_delete_image', slide_id=slide.id, lang=lang) }}"
                            onclick="return confirm('{{ 'Are you sure you want to delete this image? The slide will remain but the image will be removed.' if lang=='en' else 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø©ØŸ Ø³ØªØ¸Ù„ Ø§Ù„Ø´Ø±ÙŠØ­Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© ÙˆÙ„ÙƒÙ† Ø¨Ø¯ÙˆÙ† ØµÙˆØ±Ø©.' }}');"
                            class="inline-flex items-center justify-center w-full px-4 py-2 text-sm font-medium text-white bg-red-500 rounded-lg hover:bg-red-600 transition">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                            {{ 'Delete Image' if lang=='en' else 'Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©' }}
                        </a>

                        <p class="text-xs text-gray-500 text-center">{{ 'or' if lang=='en' else 'Ø£Ùˆ' }}</p>

                        <label for="new_image" class="block text-sm font-medium text-gray-700 mb-1">{{ 'Replace Image' if lang=='en' else 'Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø©:' }}</label>
                        
                        {# ğŸ¯ Ø§Ù„ØªØµØ­ÙŠØ­ 2: Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø£Ù‚ÙˆØ§Ø³ Ù‡Ù†Ø§ (Ù‡Ø°Ø§ Ø§Ù„Ø­Ù‚Ù„ ØºÙŠØ± Ø¶Ø±ÙˆØ±ÙŠ ÙˆÙŠÙ…ÙƒÙ† Ø­Ø°ÙÙ‡ Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ØªÙƒØ±Ø§Ø±) #}
                        <input type="hidden" name="csrf_token" value="{{ csrf_token }}"> 
                        
                        <input type="file" name="new_image" id="new_image" accept="image/*"
                                class="w-full text-xs p-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 bg-white shadow-sm">

                    </div>
                </div>
            </div>
            {% endif %}

            {# Ø­Ù‚Ù„ Ø±ÙØ¹ ØµÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø© (ÙŠØ¸Ù‡Ø± ÙƒØ®ÙŠØ§Ø± Ø±Ø¦ÙŠØ³ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø£Ùˆ Ø¨Ø¹Ø¯ Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø©) #}
            {% if not slide or not slide.image_path %}
            <div>
                <label for="new_image" class="block text-lg font-semibold text-gray-700 mb-2">
                    {{ 'Upload Image (Required)' if lang=='en' else 'Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© (Ù…Ø·Ù„ÙˆØ¨ Ù„Ù„Ø¥Ø¶Ø§ÙØ©)' }}
                </label>
                <input type="file" name="new_image" id="new_image" accept="image/*"
                        required 
                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 bg-white shadow-sm">
                <p class="mt-1 text-xs text-gray-500">{{ 'Image recommended size: 1920x1080 for best quality.' if lang=='en' else 'Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡: 1920x1080 Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£ÙØ¶Ù„ Ø¬ÙˆØ¯Ø©.' }}</p>
            </div>
            {% endif %}


            <hr class="border-gray-200">
            <div>
                <label for="title_ar" class="block text-lg font-semibold text-gray-700 mb-2 text-right">{{ 'Title (Arabic)' if lang=='en' else 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©)' }}</label>
                <input type="text" name="title_ar" id="title_ar" value="{{ slide.title_ar if slide else '' }}" required
                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 text-right font-cairo shadow-sm"
                        placeholder="{{ 'Ø§ÙƒØªØ¨ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù„Ø´Ø±ÙŠØ­Ø©...' if lang=='ar' else 'Enter the main slide title...' }}">
            </div>

            <div>
                <label for="desc_ar" class="block text-lg font-semibold text-gray-700 mb-2 text-right">{{ 'Description (Arabic)' if lang=='en' else 'Ø§Ù„ÙˆØµÙ Ø§Ù„Ù‚ØµÙŠØ± (Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©)' }}</label>
                <textarea name="desc_ar" id="desc_ar" rows="3" required
                              class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 text-right font-cairo shadow-sm"
                              placeholder="{{ 'Ø§ÙƒØªØ¨ ÙˆØµÙØ§Ù‹ Ù‚ØµÙŠØ±Ø§Ù‹ ÙˆØ¬Ø°Ø§Ø¨Ø§Ù‹...' if lang=='ar' else 'Write a short, compelling description...' }}">{{ slide.desc_ar if slide else '' }}</textarea>
            </div>

            <hr class="border-gray-200">
            
            <div>
                <label for="title_en" class="block text-lg font-semibold text-gray-700 mb-2">{{ 'Title (English)' if lang=='en' else 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©)' }}</label>
                <input type="text" name="title_en" id="title_en" value="{{ slide.title_en if slide else '' }}" required
                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 shadow-sm"
                        placeholder="{{ 'Enter the main slide title...' if lang=='en' else 'Ø§ÙƒØªØ¨ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù„Ø´Ø±ÙŠØ­Ø©...' }}">
            </div>

            <div>
                <label for="desc_en" class="block text-lg font-semibold text-gray-700 mb-2">{{ 'Description (English)' if lang=='en' else 'Ø§Ù„ÙˆØµÙ Ø§Ù„Ù‚ØµÙŠØ± (Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©)' }}</label>
                <textarea name="desc_en" id="desc_en" rows="3" required
                              class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 shadow-sm"
                              placeholder="{{ 'Write a short, compelling description...' if lang=='en' else 'Ø§ÙƒØªØ¨ ÙˆØµÙØ§Ù‹ Ù‚ØµÙŠØ±Ø§Ù‹ ÙˆØ¬Ø°Ø§Ø¨Ø§Ù‹...' }}">{{ slide.desc_en if slide else '' }}</textarea>
            </div>

            {# Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© #}
            <div class="flex justify-between items-center pt-4">
                <div class="flex gap-4">
                    <button type="submit" class="px-8 py-3 bg-indigo-600 text-white font-bold rounded-full shadow-lg hover:bg-indigo-700 transition transform hover:scale-105 inline-flex items-center gap-2">
                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                        {% if slide %}
                            {{ 'Save Changes' if lang=='en' else 'Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª' }}
                        {% else %}
                            {{ 'Add Slide' if lang=='en' else 'Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø´Ø±ÙŠØ­Ø©' }}
                        {% endif %}
                    </button>
                    
                    {% if slide %}
                    <a href="{{ url_for('admin_slider_delete', slide_id=slide.id, lang=lang) }}"
                        onclick="return confirm('{{ 'Are you sure you want to delete this entire slide?' if lang=='en' else 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø´Ø±ÙŠØ­Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ' }}');"
                        class="px-4 py-3 bg-red-600 text-white font-bold rounded-full shadow-lg hover:bg-red-700 transition inline-flex items-center gap-2">
                        {{ 'Delete Slide' if lang=='en' else 'Ø­Ø°Ù Ø§Ù„Ø´Ø±ÙŠØ­Ø©' }}
                    </a>
                    {% endif %}
                </div>
                
                <a href="{{ url_for('admin_index', lang=lang) }}" class="text-gray-500 hover:text-gray-800 transition font-semibold">
                    &larr; {{ 'Back to Dashboard' if lang=='en' else 'Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…' }}
                </a>
            </div>

        </form>
    </div>
</main>
{% endblock %}
